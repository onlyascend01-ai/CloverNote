<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Clover Suite</title>
    <link rel="icon" type="image/png" href="CloverNote.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #064e3b;
            --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
        }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; margin: 0; padding: 0; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .animate-in { animation: fadeInUp 1s var(--ease-out-expo) forwards; }
        .scale-in { animation: scaleIn 0.5s var(--ease-out-expo) forwards; }

        .checkout-container { max-width: 1000px; margin: 0 auto; }

        .btn-pay { transition: all 0.4s var(--ease-out-expo); cursor: pointer; }
        .btn-pay:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 20px 40px -10px rgba(6, 78, 59, 0.3); }
        .btn-pay:active { transform: scale(0.98); }
        .btn-pay:disabled { opacity: 0.5; transform: none; box-shadow: none; cursor: not-allowed; }

        .loading-spinner { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid #fff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        input { transition: all 0.3s var(--ease-out-expo); }
        input:focus { transform: scale(1.01); background: white !important; }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px);
            display: none; align-items: center; justify-content: center; z-index: 2000;
            opacity: 0; transition: all 0.5s var(--ease-out-expo);
        }
        .modal-overlay.active { display: flex !important; opacity: 1; }
        .modal-content {
            background: white; border-radius: 40px; width: 90%; max-width: 440px; padding: 48px;
            text-align: center; transform: translateY(30px) scale(0.9);
            transition: all 0.5s var(--ease-out-expo);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
        .modal-overlay.active .modal-content { transform: translateY(0) scale(1); }

        .order-summary { transition: all 0.5s var(--ease-out-expo); }
        .order-summary:hover { transform: scale(1.02); }
    </style>
</head>
<body class="text-slate-900 antialiased selection:bg-emerald-100 min-h-screen flex flex-col">
    <nav class="h-16 flex items-center bg-white border-b border-slate-200 px-8 flex-shrink-0">
        <div class="flex items-center gap-2 group cursor-pointer" onclick="window.location.href='index.html'">
            <img src="CloverNote.png" class="w-6 h-6 transition-transform group-hover:rotate-12">
            <span class="font-extrabold text-emerald-900 uppercase tracking-widest text-xs">Clover Suite</span>
        </div>
    </nav>

    <main class="py-12 px-6 flex-1 overflow-y-auto">
        <div class="checkout-container grid grid-cols-1 lg:grid-cols-3 gap-12 animate-in">
            <div class="lg:col-span-2 space-y-8">
                <div>
                    <h1 class="text-3xl font-black tracking-tight mb-2">Complete your purchase</h1>
                    <p class="text-slate-500 font-medium">Account: <span id="checkout-user-display" class="font-bold text-emerald-600">Checking...</span></p>
                </div>

                <section class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm space-y-6">
                    <h2 class="text-lg font-bold flex items-center gap-3">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                        Payment Information
                    </h2>
                    <div class="space-y-4">
                        <input type="text" id="card-number" placeholder="Card Number" class="w-full p-4 bg-slate-50 rounded-xl outline-none border border-transparent focus:border-emerald-500 font-bold">
                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" id="card-expiry" placeholder="MM/YY" class="w-full p-4 bg-slate-50 rounded-xl outline-none border border-transparent focus:border-emerald-500 font-bold text-center">
                            <input type="password" id="card-cvc" placeholder="CVC" class="w-full p-4 bg-slate-50 rounded-xl outline-none border border-transparent focus:border-emerald-500 font-bold text-center">
                        </div>
                    </div>
                </section>

                <button onclick="handlePayment()" id="pay-button" class="btn-pay w-full py-6 bg-emerald-900 text-white rounded-2xl font-black text-lg shadow-xl shadow-emerald-900/20 flex items-center justify-center gap-3">
                    <span id="button-text">Pay $0.00</span>
                    <div id="spinner" class="loading-spinner"></div>
                </button>
                <p class="text-center text-[10px] font-bold text-slate-400 uppercase tracking-widest">Secured by Stripe-Grade Encryption</p>
            </div>

            <div class="space-y-6">
                <div class="order-summary bg-emerald-900 text-white p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden">
                    <h3 class="text-xl font-bold mb-6 relative z-10">Order Summary</h3>
                    <div class="space-y-4 relative z-10">
                        <div class="flex justify-between items-center pb-4 border-b border-white/10">
                            <span id="plan-name" class="font-bold opacity-60">Loading...</span>
                            <span id="plan-price" class="font-black">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-xl">
                            <span class="font-black">Total</span>
                            <span id="total-price" class="font-black">$0.00</span>
                        </div>
                    </div>
                    <img src="CloverNote.png" class="absolute -bottom-10 -right-10 w-40 opacity-10 rotate-12 animate-pulse">
                </div>
            </div>
        </div>
    </main>

    <div id="success-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="w-20 h-20 bg-emerald-50 text-emerald-600 rounded-[2rem] flex items-center justify-center mx-auto mb-8 shadow-inner scale-in">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <h2 class="text-3xl font-black mb-4 tracking-tight">Payment Success!</h2>
            <p id="success-message" class="text-slate-500 font-medium mb-10 leading-relaxed text-sm">Your Pro features are unlocked. Download the installer below to start writing.</p>
            <div class="space-y-3">
                <button onclick="finishCheckout()" class="w-full py-5 bg-emerald-900 text-white rounded-2xl font-black text-sm hover:bg-emerald-800 transition-all active:scale-95 shadow-lg shadow-emerald-900/20">Download Installer</button>
                <button onclick="window.location.href='index.html'" class="w-full py-4 text-slate-400 font-bold text-xs uppercase tracking-widest hover:text-slate-600 transition-colors">Back to Home</button>
            </div>
        </div>
    </div>

    <script>
        const userObj = JSON.parse(localStorage.getItem('clover-user') || 'null');
        const currentUser = userObj ? (userObj.username || userObj.name) : 'Guest Session';
        document.getElementById('checkout-user-display').textContent = currentUser;

        const plans = {
            'monthly': { name: 'Pro Monthly', price: 5.00 },
            'lifetime': { name: 'Pro Lifetime', price: 15.00 },
            'premium': { name: 'Premium (100GB)', price: 9.99 },
            'advanced': { name: 'Advanced (500GB)', price: 19.99 },
            'ultra': { name: 'Ultra (2TB)', price: 49.99 }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const selectedPlanKey = urlParams.get('plan') || 'monthly';
        const plan = plans[selectedPlanKey] || plans.monthly;

        document.getElementById('plan-name').textContent = plan.name;
        document.getElementById('plan-price').textContent = `$${plan.price.toFixed(2)}`;
        document.getElementById('total-price').textContent = `$${plan.price.toFixed(2)}`;
        document.getElementById('button-text').textContent = `Pay $${plan.price.toFixed(2)}`;
        document.getElementById('success-message').textContent = `Your ${plan.name} features are now unlocked. Download the installer to start using the Pro build.`;

        function handlePayment() {
            const btn = document.getElementById('pay-button');
            const text = document.getElementById('button-text');
            const spinner = document.getElementById('spinner');

            btn.disabled = true;
            text.textContent = "Processing...";
            spinner.style.display = "block";

            setTimeout(simulateSuccess, 2000);
        }

        function simulateSuccess() {
            if (userObj) {
                const username = userObj.username || userObj.name;
                const userData = JSON.parse(localStorage.getItem(`clover-data-${username}`) || '{}');
                userData.plan = selectedPlanKey;
                userData.isPro = true;
                localStorage.setItem(`clover-data-${username}`, JSON.stringify(userData));

                localStorage.setItem('clover-drive-tier', selectedPlanKey);
                localStorage.setItem('clover-premium-active', 'true');
            }
            document.getElementById('success-modal').classList.add('active');
        }

        function finishCheckout() {
            const localInstallerPath = "./dist/CloverNote_Setup_2.0.0.exe";
            const link = document.createElement('a');
            link.href = localInstallerPath;
            link.setAttribute('download', 'CloverNote_Setup_2.0.0.exe');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            setTimeout(() => {
                window.location.href = 'index.html';
            }, 3000);
        }
    </script>
</body>
</html>
